package chess

import "fmt"

type chessBoardEvaluator struct {

}

var chessPieceValueMap = map[chessType]int {
	_CHESS_NULL: 0,
	_CHESS_CAR: 100,
	_CHESS_HORSE: 40,
	_CHESS_CANNON: 45,
	_CHESS_ELEPHANT: 20,
	_CHESS_GUARD: 20,
	_CHESS_KING: 1000,
	_CHESS_PAWN: 10,
}

var chessPiecePositionValueMap = map[string][][]int {
	fmt.Sprintf("%d%d", _CHESS_CAR, _COLOR_RED): {
		{ 160, 170, 160, 150, 150, 150, 160, 170, 160 },
		{ 170, 180, 170, 190, 250, 190, 170, 180, 170 },
		{ 170, 190, 200, 220, 240, 220, 200, 190, 170 },
		{ 180, 220, 210, 240, 250, 240, 210, 220, 180 },
		{ 180, 220, 210, 240, 250, 240, 210, 220, 180 },
		{ 180, 220, 210, 240, 250, 240, 210, 220, 180 },
		{ 170, 190, 180, 220, 240, 220, 200, 190, 170 },
		{ 170, 180, 170, 170, 160, 170, 170, 180, 170 },
		{ 160, 170, 160, 160, 150, 160, 160, 170, 160 },
		{ 150, 160, 150, 160, 150, 160, 150, 160, 150 },
	},
	fmt.Sprintf("%d%d", _CHESS_HORSE, _COLOR_RED): {
		{ 70, 80,  90,  80,  70,  80,  90,  80,  70 },
		{ 80, 110, 125, 90,  70,  90,  125, 110, 80 },
		{ 90, 100, 120, 125, 120, 125, 120, 100, 90 },
		{ 90, 100, 120, 130, 110, 130, 120, 100, 90 },
		{ 90, 110, 110, 120, 100, 120, 110, 110, 90 },
		{ 90, 100, 100, 110, 100, 110, 100, 100, 90 },
		{ 80, 90,  100, 100, 90,  100, 100, 90,  80 },
		{ 80, 80,  90,  90,  80,  90,  90,  80,  80 },
		{ 70, 75,  75,  70,  50,  70,  75,  75,  70 },
		{ 60, 70,  75,  70,  60,  70,  75,  70,  60 },
	},
	fmt.Sprintf("%d%d", _CHESS_CANNON, _COLOR_RED): {
		{ 125, 130, 100, 70, 60, 70, 100, 130, 125 },
		{ 110, 125, 100, 70, 60, 70, 100, 125, 110 },
		{ 100, 120, 90,  80, 80, 80, 90,  120, 100 },
		{ 90,  110, 90, 110, 130, 110, 90, 110, 90 },
		{ 90,  110, 90, 110, 130, 110, 90, 110, 90 },
		{ 90,  100, 90, 110, 130, 110, 90, 100, 90 },
		{ 90,  100, 90, 90,  110, 90,  90, 100, 90 },
		{ 90,  100, 80, 80,  70,  80,  80, 100, 90 },
		{ 80, 90, 80, 70, 65, 70, 80, 90, 80 },
		{ 80, 90, 80, 70, 60, 70, 80, 90, 80 },
	},
	fmt.Sprintf("%d%d", _CHESS_ELEPHANT, _COLOR_RED): {
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 25, 0, 0, 0, 25, 0, 0},
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 20, 0, 0, 0, 35, 0, 0, 0, 20 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 30, 0, 0, 0, 30, 0, 0 },
	},
	fmt.Sprintf("%d%d", _CHESS_GUARD, _COLOR_RED): {
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 30, 0, 30, 0, 0, 0 },
		{ 0, 0, 0, 0, 22, 0, 0, 0, 0 },
		{ 0, 0, 0, 30, 0, 30, 0, 0, 0 },
	},
	fmt.Sprintf("%d%d", _CHESS_KING, _COLOR_RED): {
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 1, 1, 1, 0, 0, 0 },
		{ 0, 0, 0, 10, 10, 10, 0, 0, 0 },
		{ 0, 0, 0, 15, 20, 15, 0, 0, 0 },
	},
	fmt.Sprintf("%d%d", _CHESS_PAWN, _COLOR_RED): {
		{ 10, 10, 10, 20, 25, 20, 10, 10, 10 },
		{ 25, 30, 40, 50, 60, 50, 40, 30, 25 },
		{ 25, 30, 30, 40, 40, 40, 30, 30, 25 },
		{ 20, 25, 25, 30, 30, 30, 25, 25, 20 },
		{ 15, 20, 20, 20, 20, 20, 20, 20, 15 },
		{ 10, 0, 15, 0, 15, 0, 15, 0, 10 },
		{ 10, 0, 10, 0, 15, 0, 10, 0, 10 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	},
	fmt.Sprintf("%d%d", _CHESS_CAR, _COLOR_BLACK): {
		{ 150, 160, 150, 160, 150, 160, 150, 160, 150 },
		{ 160, 170, 160, 160, 150, 160, 160, 170, 160 },
		{ 170, 180, 170, 170, 160, 170, 170, 180, 170 },
		{ 170, 190, 180, 220, 240, 220, 200, 190, 170 },
		{ 180, 220, 210, 240, 250, 240, 210, 220, 180 },
		{ 180, 220, 210, 240, 250, 240, 210, 220, 180 },
		{ 180, 220, 210, 240, 250, 240, 210, 220, 180 },
		{ 170, 190, 200, 220, 240, 220, 200, 190, 170 },
		{ 170, 180, 170, 190, 250, 190, 170, 180, 170 },
		{ 160, 170, 160, 150, 150, 150, 160, 170, 160 },
	},
	fmt.Sprintf("%d%d", _CHESS_HORSE, _COLOR_BLACK): {
		{ 60, 70,  75,  70,  60,  70,  75,  70,  60 },
		{ 70, 75,  75,  70,  50,  70,  75,  75,  70 },
		{ 80, 80,  90,  90,  80,  90,  90,  80,  80 },
		{ 80, 90,  100, 100, 90,  100, 100, 90,  80 },
		{ 90, 100, 100, 110, 100, 110, 100, 100, 90 },
		{ 90, 110, 110, 120, 100, 120, 110, 110, 90 },
		{ 90, 100, 120, 130, 110, 130, 120, 100, 90 },
		{ 90, 100, 120, 125, 120, 125, 120, 100, 90 },
		{ 80, 110, 125, 90,  70,  90,  125, 110, 80 },
		{ 70, 80,  90,  80,  70,  80,  90,  80,  70 },
	},
	fmt.Sprintf("%d%d", _CHESS_CANNON, _COLOR_BLACK): {
		{ 80, 90, 80, 70, 60, 70, 80, 90, 80 },
		{ 80, 90, 80, 70, 65, 70, 80, 90, 80 },
		{ 90,  100, 80, 80,  70,  80,  80, 100, 90 },
		{ 90,  100, 90, 90,  110, 90,  90, 100, 90 },
		{ 90,  100, 90, 110, 130, 110, 90, 100, 90 },
		{ 90,  110, 90, 110, 130, 110, 90, 110, 90 },
		{ 90,  110, 90, 110, 130, 110, 90, 110, 90 },
		{ 100, 120, 90,  80, 80, 80, 90,  120, 100 },
		{ 110, 125, 100, 70, 60, 70, 100, 125, 110 },
		{ 125, 130, 100, 70, 60, 70, 100, 130, 125 },
	},
	fmt.Sprintf("%d%d", _CHESS_ELEPHANT, _COLOR_BLACK): {
		{ 0, 0, 30, 0, 0, 0, 30, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 20, 0, 0, 0, 35, 0, 0, 0, 20 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 25, 0, 0, 0, 25, 0, 0},
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	},
	fmt.Sprintf("%d%d", _CHESS_GUARD, _COLOR_BLACK): {
		{ 0, 0, 0, 30, 0, 30, 0, 0, 0 },
		{ 0, 0, 0, 0, 22, 0, 0, 0, 0 },
		{ 0, 0, 0, 30, 0, 30, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	},
	fmt.Sprintf("%d%d", _CHESS_KING, _COLOR_BLACK): {
		{ 0, 0, 0, 15, 20, 15, 0, 0, 0 },
		{ 0, 0, 0, 10, 10, 10, 0, 0, 0 },
		{ 0, 0, 0, 1, 1, 1, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	},
	fmt.Sprintf("%d%d", _CHESS_PAWN, _COLOR_BLACK): {
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ 10, 0, 10, 1, 15, 0, 10, 0, 10 },
		{ 10, 0, 15, 0, 15, 0, 15, 0, 10 },
		{ 15, 20, 20, 20, 20, 20, 20, 20, 15 },
		{ 20, 25, 25, 30, 30, 30, 25, 25, 20 },
		{ 25, 30, 30, 40, 40, 40, 30, 30, 25 },
		{ 25, 30, 40, 50, 60, 50, 40, 30, 25 },
		{ 10, 10, 10, 20, 25, 20, 10, 10, 10 },
	},
}

func newChessBoardEvaluator() *chessBoardEvaluator {
	return &chessBoardEvaluator{}
}

func (cbe *chessBoardEvaluator) eval(chessBoard chessBoard) int {
	return cbe.evalValue(chessBoard, _COLOR_BLACK) - cbe.evalValue(chessBoard, _COLOR_RED)
}

func (cbe *chessBoardEvaluator) evalValue(chessBoard chessBoard, color chessColor) int {
	return cbe.evalPieceValue(chessBoard, color) + cbe.evalPositionValue(chessBoard, color)
}

func (cbe *chessBoardEvaluator) evalPieceValue(chessBoard chessBoard, color chessColor) int {
	result := 0
	for row := 0; row < _BOARD_ROW; row++ {
		for col := 0; col < _BOARD_COL; col++ {
			chess := chessBoard[row][col]
			if chess.color == color {
				result += chessPieceValueMap[chess._type]
			}
		}
	}
	return result
}

func (cbe *chessBoardEvaluator) evalPositionValue(chessBoard chessBoard, color chessColor) int {
	result := 0
	for row := 0; row < _BOARD_ROW; row++ {
		for col := 0; col < _BOARD_COL; col++ {
			chess := chessBoard[row][col]
			if chess._type != _CHESS_NULL && chess.color == color {
				result += chessPiecePositionValueMap[chess.string()][row][col]
			}
		}
	}
	return result
}

